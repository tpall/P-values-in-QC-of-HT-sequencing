---
title: "Analysis of HT-sequencing data from GEO database"
author: "Taavi Päll, Tanel Tenson, Ülo Maiväli"
date: '2017-04-27'
output:
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r plot-sparks}
library(sparklines)
library(formattable)
load("data/sparklines2_plot-sparks.RData")
tab_coln <- c("Accession","Supplemental file","P values\norigin","P value\nhistogram","SRP", "pi0","Effects in\nreplication\nstudy","Undis\ncovered","FP")
format_table(p, list(
  spark = FALSE,
  histograms = function(x) sapply(paste0(text = '`r p$spark[[', 1:nrow(p), ']]`'), function(md) knitr::knit(text = md, quiet = T)),
  SRP = function(x) digits(x, digits = 2),
  pi0 = function(x) digits(x, digits = 2),
  rs = function(x) digits(x, digits = 0),
  ud = function(x) digits(x, digits = 0),
  fp = function(x) digits(x, digits = 0)),
  align = c("l", "r", rep("l", 7)),
  col.names = tab_coln,
  caption = "Table 1. **P value histograms, estimated pi0, and stable retrospective power (SRP)**. P values are from likelihood ratio tests where full model formula was compared against intercept-only formula. SRP was calculated using FDR threshold of 0.05. pi0, the proportion of true null effects. FP, estimated number of false positives. NA, no effects (pi0 = 1), power calculation not meaningful. P value histogram coloring is based on unsupervised clustering of empirical cumulative distribution function values at histogram bins.")
```

